---
title: "Classification from Scratch"
author: "Bizovi Mihai"
date: "July 16, 2018"
output: html_document
---

[Raw Code and unprocessed notes, use for own risk until declared ready]

`https://freakonometrics.hypotheses.org/` has a lot of great content which is theoretically well founded. Carpentier's series on classification from Scratch drew my attention as an excellent way to go back to the basics of well known models and algorithms. Moreover, he provides minimalist R code which gets to the essence and can be improved as an exercise, which will be used for practice.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(ggthemes)
library(GGally)
```

```{r}
data <- data.frame(
  x1 = c(.4, .55, .65, .9, .1, .35, .5, .15, .2, .85),
  x2 = c(.85, .95, .8, .87, .5, .55, .5, .2, .1, .3),
  y  = c(1, 1, 1, 1, 1, 0, 0, 1, 0, 0)
)

p <- data %>% 
  mutate(y = as.factor(y)) %>%
  ggplot(aes(x1, x2, color = y)) + 
  geom_point(size = 3) + 
  theme_minimal() + 
  labs(x = "First Feature", y = "Second Feature") + 
  guides(color = guide_legend(title = "target")) + 
  scale_color_ptol()
p
```

```{r}
myocarde <- read.table("http://freakonometrics.free.fr/myocarde.csv",
                      head=TRUE, sep=";") %>% 
  mutate(PRONO = as.numeric(PRONO == "SURVIE"))

y = myocarde$PRONO
X = as.matrix(cbind(1,myocarde[,1:7]))
```

* heart rate
* heart index
* stroke index
* diastolic pressure
* plumonary arterial pressure
* ventricular pressure
* lung resistance
* death or survival

```{r, fig.width=9, fig.height=7}
myocarde %>% 
  ggpairs(columns = 1:7, aes(color = as.factor(PRONO))) + 
  theme_tufte()
```

$$Y \lvert X = x \sim \mathcal{B}(p_x)$$, where 
$$p_x = \frac{\exp{x^T\beta}}{1 + \exp{x^T\beta}}$$

$$
\log \frac{\mathbb{P}(Y = 1)}{\mathbb{P}(Y = 0)} = x^T\beta
$$
$$
\log \mathcal{L} = \sum \limits_{i=1}^n y_i \log p_i + (1 - y_i) \log(1 - p_i)
$$

$$p_i = (1 + \exp(-x_i^T \beta))^{-1}$$

```{r}
y <- myocarde$PRONO
X <- cbind(1, as.matrix(myocarde[, 1:7]))

neg_log_lik <- function(coeffs) {
  -sum(-y * log(1 + exp(-(X %*% coeffs))) - (1-y) * log(1 + exp(X %*% coeffs)))
}

beta_init <- lm(PRONO ~ ., data = myocarde)$coefficients

logistic_opt <- optim(par = beta_init, neg_log_lik, hessian = TRUE)
logistic_opt$par
```
```{r}
simu = function(i){
logistic_opt_i = optim(par = rnorm(8,0,3)*beta_init, 
neg_log_lik, hessian=TRUE, method = "BFGS", 
control=list(abstol=1e-9))
logistic_opt_i$par[2:3]
}
v_beta = t(Vectorize(simu)(1:1000))
plot(v_beta)
par(mfrow=c(1,2))
hist(v_beta[,1],xlab=names(myocarde)[1])
hist(v_beta[,2],xlab=names(myocarde)[2])
```







